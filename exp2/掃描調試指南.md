# 藍牙掃描調試指南

## 🔍 **掃描問題診斷**

### 問題分析
您提到「不是掃描的問題嗎」，這確實是關鍵！HM-10 設備可能因為以下原因無法被掃描到：

1. **設備名稱問題**: HM-10 可能沒有正確設定名稱
2. **廣播設定問題**: 設備可能沒有正確廣播
3. **掃描邏輯問題**: Flutter 掃描邏輯可能過於嚴格

## ✅ **已完成的改進**

### 1. **改進掃描邏輯**
- 增加掃描時間到 15 秒
- 添加更詳細的調試輸出
- 包含更多可能的設備名稱
- 顯示所有設備，包括沒有名稱的

### 2. **改進設備顯示**
- 標示可能的目標設備
- 顯示設備類型信息
- 更好的設備識別

## 🧪 **測試步驟**

### 步驟 1: 檢查 Arduino 輸出
1. 上傳更新後的 Arduino 程式碼
2. 打開序列埠監視器 (9600 baud)
3. 確認看到：
   ```
   Arduino HM-10 BLE 發送器已啟動
   🔧 初始化 HM-10 模組...
   ✅ HM-10 初始化完成
   ```

### 步驟 2: 測試 Flutter 掃描
1. 打開 Flutter 應用程式
2. 點擊「掃描新設備」按鈕
3. 觀察控制台輸出，應該看到：
   ```
   🔍 開始掃描所有藍牙設備...
   📡 掃描結果: X 個設備
   🔍 發現設備: [設備名稱] ([設備ID])
   ```

### 步驟 3: 測試 HM-10 專用掃描
1. 點擊「掃描 HM-10」按鈕
2. 觀察是否找到名為 "Arduino_ECG" 的設備
3. 如果沒有，嘗試連接任何顯示的設備

## 🔧 **手動調試方法**

### 方法 1: 檢查設備名稱
在 Arduino 序列埠監視器中發送：
```
AT+NAME
```
應該回傳：`Arduino_ECG`

### 方法 2: 檢查廣播狀態
```
AT+ADVI?
```
應該回傳：`1` (表示正在廣播)

### 方法 3: 檢查連接狀態
```
AT+CONN?
```
應該回傳：`0` (表示未連接)

## 📱 **Flutter 應用程式調試**

### 查看控制台輸出
在 Flutter 應用程式運行時，查看控制台是否有以下輸出：
```
🔍 開始掃描所有藍牙設備...
📡 掃描結果: X 個設備
🔍 發現設備: [設備名稱] ([設備ID])
✅ 添加設備: [設備名稱]
📱 掃描完成，找到 X 個設備
```

### 如果沒有找到設備
1. 確認手機藍牙已開啟
2. 確認應用程式有藍牙權限
3. 嘗試重新啟動應用程式
4. 檢查 Arduino 是否正在運行

## 🎯 **目標設備識別**

### 可能的設備名稱
- `Arduino_ECG` (我們設定的名稱)
- `HM-10` 或 `HM10`
- `CC2541` 或 `CC2540` (HM-10 晶片型號)
- 空白名稱的設備
- `Unknown` 設備

### 設備特徵
- 信號強度較弱 (因為是 BLE 設備)
- 可能沒有顯示名稱
- 設備 ID 通常以特定格式開頭

## 🚨 **常見問題解決**

### 問題 1: 掃描不到任何設備
**解決方案**:
1. 確認手機藍牙已開啟
2. 確認應用程式權限
3. 重新啟動應用程式
4. 檢查 Arduino 是否運行

### 問題 2: 找到設備但無法連接
**解決方案**:
1. 確認 HM-10 已正確初始化
2. 檢查 Arduino 序列埠監視器
3. 嘗試重新上傳 Arduino 程式碼

### 問題 3: 連接後立即斷開
**解決方案**:
1. 檢查電源供應
2. 確認 HM-10 設定正確
3. 嘗試降低發送頻率

## 📋 **調試檢查清單**

- [ ] Arduino 程式碼已上傳
- [ ] 序列埠監視器顯示初始化成功
- [ ] 手機藍牙已開啟
- [ ] 應用程式有藍牙權限
- [ ] 掃描時有控制台輸出
- [ ] 找到至少一個設備
- [ ] 嘗試連接設備
- [ ] 檢查連接狀態

## 🔄 **下一步測試**

1. **立即測試**: 使用更新後的程式碼進行掃描
2. **查看輸出**: 觀察控制台和序列埠監視器的輸出
3. **嘗試連接**: 即使設備名稱不確定，也嘗試連接
4. **報告結果**: 告訴我掃描到了什麼設備

如果仍然有問題，請提供：
1. Arduino 序列埠監視器的完整輸出
2. Flutter 應用程式控制台的輸出
3. 掃描到的設備列表
4. 任何錯誤訊息


