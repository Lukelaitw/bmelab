# HM-10 BLE 模組連接指南

## 硬體連接

### HM-10 接線方式
```
Arduino Uno    HM-10
---------      ------
5V      →      VCC
GND     →      GND
Pin 2   →      TXD (HM-10的TX)
Pin 3   →      RXD (HM-10的RX)
```

### 重要注意事項
- HM-10 的 TX 連接到 Arduino 的 Pin 2 (RX)
- HM-10 的 RX 連接到 Arduino 的 Pin 3 (TX)
- 確保電源供應穩定 (3.3V 或 5V)
- 檢查接地連接

## 軟體設定

### 1. Arduino 程式碼已更新
- 添加了 HM-10 專用初始化
- 使用 AT 指令配置模組
- 改進了數據發送方式

### 2. Flutter 應用程式設定
確保 `pubspec.yaml` 包含正確的依賴：
```yaml
dependencies:
  flutter_blue_plus: ^1.12.13
```

## 測試步驟

### 步驟 1: 上傳 Arduino 程式碼
1. 將更新後的程式碼上傳到 Arduino
2. 打開序列埠監視器 (9600 baud)
3. 確認看到以下訊息：
   ```
   Arduino HM-10 BLE 發送器已啟動
   等待 BLE 連接...
   🔧 初始化 HM-10 模組...
   ✅ HM-10 初始化完成
   ```

### 步驟 2: 檢查 HM-10 狀態
在序列埠監視器中發送以下 AT 指令：
```
AT
AT+VERSION
AT+NAME
AT+ROLE
```

### 步驟 3: 測試 Flutter 連接
1. 打開 Flutter 應用程式
2. 點擊「掃描 HM-10」按鈕
3. 尋找名為 "Arduino_ECG" 的設備
4. 點擊連接

### 步驟 4: 測試數據傳輸
1. 連接成功後，切換到「數據顯示」頁面
2. 點擊「開始ADC」按鈕
3. 觀察是否接收到數據

## 常見問題解決

### 問題 1: 找不到 HM-10 設備
**解決方案**:
1. 確認 HM-10 已正確初始化
2. 檢查序列埠監視器是否有錯誤訊息
3. 嘗試重新上傳程式碼
4. 檢查硬體連接

### 問題 2: 連接後立即斷開
**解決方案**:
1. 檢查電源供應是否穩定
2. 確認 HM-10 的 AT 指令回應正常
3. 嘗試降低發送頻率

### 問題 3: 無法接收數據
**解決方案**:
1. 確認 Arduino 程式碼中的 `adc_running = true`
2. 檢查序列埠監視器是否有數據輸出
3. 測試發送 "START_ADC" 指令

## 調試指令

### Arduino 序列埠監視器指令
```
AT              - 檢查連接
AT+VERSION      - 查看版本
AT+NAME         - 查看設備名稱
AT+ROLE         - 查看角色設定
AT+CONN?        - 檢查連接狀態
AT+ADVI1        - 開始廣播
```

### Flutter 應用程式測試
1. 使用「測試通訊」按鈕發送 HELLO
2. 使用「PING測試」按鈕測試連接
3. 使用「測試ADC」按鈕模擬數據

## 預期結果

### 正常運作時應該看到：
1. **Arduino 序列埠監視器**:
   ```
   📤 發送藍牙數據: ADC_DATA:512,2.500,12345
   📊 ADC: 512 (2.500V) - 時間: 12345
   ✅ 數據已發送到 HM-10
   ```

2. **Flutter 應用程式**:
   - 藍牙連接狀態顯示為已連接
   - 數據頁面顯示接收到的 ADC 數據
   - ECG 頁面顯示波形圖

## 如果問題仍然存在

請提供以下資訊：
1. Arduino 序列埠監視器的完整輸出
2. Flutter 應用程式的錯誤訊息
3. 硬體連接照片
4. HM-10 模組的型號和版本

## 替代方案

如果 HM-10 仍有問題，可以考慮：
1. 使用 ESP32 的內建藍牙功能
2. 使用 WiFi 通訊替代藍牙
3. 使用 USB 序列埠通訊


