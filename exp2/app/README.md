# Arduino 藍牙連接應用程式

這是一個基於Flutter開發的藍牙連接應用程式，專門用於與Arduino藍牙模組進行通信，支援數據接收、發送和ECG波形顯示。

## 功能特色

### 🔵 藍牙連接功能
- **藍牙狀態檢查**: 自動檢測藍牙開啟/關閉狀態
- **權限管理**: 自動請求藍牙和位置權限
- **設備掃描**: 支援掃描已配對設備和新的BLE設備
- **多種掃描模式**: 
  - 掃描所有藍牙設備
  - 掃描已配對設備
  - 專門掃描HM-10等BLE設備

### 📊 數據通信功能
- **實時數據接收**: 監聽Arduino發送的數據
- **數據發送**: 向Arduino發送控制指令
- **數據解析**: 自動解析ADC數據和系統狀態
- **歷史記錄**: 保存數據接收歷史

### 📈 ECG波形顯示
- **實時波形**: 顯示ECG數據的實時波形圖
- **數據統計**: 顯示最大值、最小值、平均值等統計信息
- **控制功能**: 開始/停止ECG數據採集

## 支援的藍牙模組

- **HC-05**: 經典藍牙模組
- **HC-06**: 簡化版藍牙模組  
- **HM-10**: BLE藍牙模組
- **HC-08**: BLE藍牙模組
- **其他BLE設備**: 支援標準BLE協議的設備

## 使用說明

### 1. 權限設置
應用程式會自動請求以下權限：
- 藍牙權限
- 藍牙掃描權限
- 藍牙連接權限
- 位置權限（Android掃描BLE必需）

### 2. 連接設備
1. 開啟應用程式
2. 確保Arduino藍牙模組已開啟
3. 點擊「已配對設備」查看已配對的設備
4. 或點擊「掃描新設備」搜尋附近的設備
5. 對於HM-10等BLE設備，點擊「掃描HM-10」
6. 選擇您的藍牙模組並點擊「連接」

### 3. 數據通信
連接成功後：
- 在「數據顯示」頁面查看接收到的數據
- 使用控制按鈕發送指令：
  - `START_ADC`: 開始ADC數據採集
  - `STOP_ADC`: 停止ADC數據採集
  - `STATUS`: 查詢系統狀態
  - `HELLO`: 測試通訊

### 4. ECG波形顯示
- 切換到「ECG圖表」頁面
- 點擊「開始ECG」開始數據採集
- 查看實時波形圖和數據統計
- 點擊「停止ECG」停止數據採集

## 數據格式

應用程式支援以下數據格式：

### ADC數據
```
ADC_DATA:512,2.500
```
- 512: ADC原始值
- 2.500: 對應的電壓值

### 系統狀態
```
SYSTEM_STATUS:OK
```

### ADC傳輸狀態
```
ADC_TRANSMISSION:STARTED
```

### 心跳信號
```
HEARTBEAT:1234567890
```

## 技術實現

### 藍牙管理
- 使用 `flutter_blue_plus` 插件進行藍牙通信
- 支援BLE和經典藍牙設備
- 自動服務發現和特徵查找
- 智能特徵選擇（優先Notify特徵）

### 權限處理
- 使用 `permission_handler` 插件管理權限
- 支援Android和iOS平台
- 詳細的權限狀態檢查和錯誤處理

### 數據處理
- 實時數據流處理
- UTF-8編碼/解碼
- 數據格式解析和驗證
- 歷史數據管理

### UI設計
- Material Design 3風格
- 響應式佈局
- 實時狀態指示
- 直觀的操作界面

## 開發環境

- Flutter SDK: >=3.0.0
- Dart: >=3.0.0
- 支援平台: iOS, Android

## 依賴套件

```yaml
dependencies:
  flutter_blue_plus: ^1.12.13
  permission_handler: ^11.0.1
  cupertino_icons: ^1.0.2
```

## 故障排除

### 常見問題

1. **無法掃描到設備**
   - 確保藍牙已開啟
   - 檢查位置權限是否授予
   - 嘗試不同的掃描模式

2. **連接失敗**
   - 確保設備在範圍內
   - 檢查設備是否已被其他應用程式連接
   - 嘗試重新配對設備

3. **數據接收異常**
   - 檢查數據格式是否正確
   - 確認Arduino程式是否正常運行
   - 查看控制台日誌獲取詳細信息

### 調試信息

應用程式會輸出詳細的調試信息到控制台，包括：
- 藍牙狀態變化
- 設備掃描結果
- 連接過程詳情
- 數據收發記錄
- 錯誤信息

## 版本歷史

- **v1.0.0**: 初始版本
  - 基本藍牙連接功能
  - 數據收發功能
  - ECG波形顯示
  - 多種掃描模式

## 授權

本專案僅供學習和研究使用。